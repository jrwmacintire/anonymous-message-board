{"version":3,"sources":["../../src/routes/fcctesting.ts"],"names":["runner","TestEmitter","app","route","get","req","res","next","console","log","fs","readFile","__dirname","err","data","send","toString","type","error","process","env","NODE_ENV","json","status","report","testFilter","query","n","on","nextTick","hs","Object","keys","header","filter","h","match","hObj","forEach","headers","tests","out","t","context","title","undefined"],"mappings":"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","sourcesContent":["/*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*       DO NOT EDIT THIS FILE\r\n*       For FCC testing purposes!\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*\r\n*/\r\n\r\n'use strict';\r\n\r\nimport cors from 'cors';\r\nimport fs from 'fs';\r\n// import runner from '../../test-runner';\r\nimport TestEmitter from '../testing/test-runner2';\r\nimport express from 'express';\r\nconst runner = new TestEmitter();\r\n\r\nexport default function (app: express.Application) {\r\n\r\n  app.route('/_api/server.js')\r\n    .get(function (req: express.Request, res: express.Response, next: Function) {\r\n      console.log('requested');\r\n      fs.readFile(__dirname + '/public/index.js', function (err, data) {\r\n        if (err) return next(err);\r\n        res.send(data.toString());\r\n      });\r\n    });\r\n  app.route('/_api/routes/api.js')\r\n    .get(function (req: express.Request, res: express.Response, next: Function) {\r\n      console.log('requested');\r\n      fs.readFile(__dirname + '/routes/api.js', function (err, data) {\r\n        if (err) return next(err);\r\n        res.type('txt').send(data.toString());\r\n      });\r\n    });\r\n  app.route('/_api/controllers/convertHandler.js')\r\n    .get(function (req: express.Request, res: express.Response, next: Function) {\r\n      console.log('requested');\r\n      fs.readFile(__dirname + '/controllers/convertHandler.js', function (err, data) {\r\n        if (err) return next(err);\r\n        res.type('txt').send(data.toString());\r\n      });\r\n    });\r\n\r\n  var error;\r\n  app.get('/_api/get-tests', cors(), function (req: express.Request, res: express.Response, next) {\r\n    console.log(error);\r\n    if (!error && process.env.NODE_ENV === 'test') return next();\r\n    res.json({ status: 'unavailable' });\r\n  },\r\n    function (req: express.Request, res: express.Response, next: Function) {\r\n      if (!runner.report) return next();\r\n      res.json(testFilter(runner.report, req.query.type, req.query.n));\r\n    },\r\n    function (req: express.Request, res: express.Response) {\r\n      runner.on('done', function (report) {\r\n        process.nextTick(() => res.json(testFilter(runner.report, req.query.type, req.query.n)));\r\n      });\r\n    });\r\n  app.get('/_api/app-info', function (req: express.Request, res: express.Response) {\r\n    var hs = Object.keys(res.header)\r\n      .filter(h => !h.match(/^access-control-\\w+/));\r\n    var hObj = {};\r\n    hs.forEach(h => { hObj[h] = res.header[h] });\r\n    delete res.header['strict-transport-security'];\r\n    res.json({ headers: hObj });\r\n  });\r\n\r\n};\r\n\r\nfunction testFilter(tests, type, n) {\r\n  var out;\r\n  switch (type) {\r\n    case 'unit':\r\n      out = tests.filter(t => t.context.match('Unit Tests'));\r\n      break;\r\n    case 'functional':\r\n      out = tests.filter(t => t.context.match('Functional Tests') && !t.title.match('#example'));\r\n      break;\r\n    default:\r\n      out = tests;\r\n  }\r\n  if (n !== undefined) {\r\n    return out[n] || out;\r\n  }\r\n  return out;\r\n}"],"file":"fcctesting.js"}